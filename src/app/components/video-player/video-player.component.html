<div class="video-player-container">
  <!-- Stream Selector -->
  <div class="stream-selector">
    <label for="stream-select">Select Stream:</label>
    <select
      id="stream-select"
      [value]="currentStreamIndex()"
      (change)="onStreamChange(+$any($event.target).value)"
      aria-label="Select video stream"
    >
      @for (stream of streams; track stream.url; let i = $index) {
        <option [value]="i">{{ stream.name }}</option>
      }
    </select>
    @if (currentStream().description) {
      <span class="stream-description">{{ currentStream().description }}</span>
    }
  </div>

  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="error-message" role="alert">
      <span class="error-icon">âš ï¸</span>
      {{ errorMessage() }}
    </div>
  }

  <!-- Video Container -->
  <div class="video-wrapper">
    <video
      #videoElement
      class="video-element"
      playsinline
      aria-label="Video player"
    ></video>

    <!-- Loading Overlay -->
    @if (isLoading()) {
      <div class="loading-overlay" aria-live="polite">
        <div class="spinner"></div>
        <span>Loading...</span>
      </div>
    }

    <!-- Click to Play Overlay -->
    <button
      class="play-overlay"
      (click)="togglePlay()"
      [attr.aria-label]="isPlaying() ? 'Pause video' : 'Play video'"
      [class.hidden]="isPlaying()"
    >
      <span class="play-icon">â–¶</span>
    </button>
  </div>

  <!-- Progress Bar -->
  <div class="progress-container">
    <span class="time-display">{{ formattedCurrentTime() }}</span>
    <div class="progress-bar-wrapper">
      <div class="buffered-bar" [style.width.%]="bufferedPercent()"></div>
      <input
        type="range"
        class="progress-bar"
        min="0"
        max="100"
        step="0.1"
        [value]="progressPercent()"
        (input)="onSeek($event)"
        aria-label="Seek video position"
      />
    </div>
    <span class="time-display">{{ formattedDuration() }}</span>
  </div>

  <!-- Controls -->
  <div class="controls">
    <!-- Left Controls -->
    <div class="controls-left">
      <!-- Play/Pause -->
      <button
        class="control-btn"
        (click)="togglePlay()"
        [attr.aria-label]="isPlaying() ? 'Pause' : 'Play'"
        [attr.title]="isPlaying() ? 'Pause' : 'Play'"
      >
        @if (isPlaying()) {
          <span class="icon">â¸</span>
        } @else {
          <span class="icon">â–¶</span>
        }
      </button>

      <!-- Stop -->
      <button
        class="control-btn"
        (click)="stop()"
        aria-label="Stop"
        title="Stop"
      >
        <span class="icon">â¹</span>
      </button>

      <!-- Seek Backward -->
      <button
        class="control-btn"
        (click)="seekBackward(10)"
        aria-label="Rewind 10 seconds"
        title="Rewind 10s"
      >
        <span class="icon">âª</span>
      </button>

      <!-- Seek Forward -->
      <button
        class="control-btn"
        (click)="seekForward(10)"
        aria-label="Forward 10 seconds"
        title="Forward 10s"
      >
        <span class="icon">â©</span>
      </button>

      <!-- Volume -->
      <div class="volume-control">
        <button
          class="control-btn"
          (click)="toggleMute()"
          [attr.aria-label]="isMuted() ? 'Unmute' : 'Mute'"
          [attr.title]="isMuted() ? 'Unmute' : 'Mute'"
        >
          @if (isMuted() || volume() === 0) {
            <span class="icon">ğŸ”‡</span>
          } @else if (volume() < 0.5) {
            <span class="icon">ğŸ”‰</span>
          } @else {
            <span class="icon">ğŸ”Š</span>
          }
        </button>
        <input
          type="range"
          class="volume-slider"
          min="0"
          max="1"
          step="0.05"
          [value]="volume()"
          (input)="onVolumeChange($event)"
          aria-label="Volume"
        />
      </div>
    </div>

    <!-- Right Controls -->
    <div class="controls-right">
      <!-- Playback Speed -->
      <div class="speed-control">
        <label for="playback-rate" class="visually-hidden">Playback speed</label>
        <select
          id="playback-rate"
          [value]="playbackRate()"
          (change)="onPlaybackRateChange(+$any($event.target).value)"
          aria-label="Playback speed"
          title="Playback speed"
        >
          @for (rate of playbackRates; track rate) {
            <option [value]="rate">{{ rate }}x</option>
          }
        </select>
      </div>

      <!-- Captions -->
      @if (availableTextTracks().length > 0) {
        <div class="caption-control">
          <button
            class="control-btn"
            [class.active]="showCaptions()"
            (click)="toggleCaptions()"
            aria-label="Toggle captions"
            title="Toggle captions"
          >
            <span class="icon">CC</span>
          </button>
          <select
            class="caption-select"
            (change)="onTextTrackChange($any($event.target).value === '' ? null : +$any($event.target).value)"
            aria-label="Select caption track"
          >
            <option value="">Off</option>
            @for (track of availableTextTracks(); track track.id) {
              <option [value]="track.id">
                {{ track.label || track.language || 'Track ' + track.id }}
              </option>
            }
          </select>
        </div>
      }

      <!-- Picture in Picture -->
      <button
        class="control-btn"
        (click)="togglePiP()"
        aria-label="Picture in Picture"
        title="Picture in Picture"
      >
        <span class="icon">ğŸ“º</span>
      </button>

      <!-- Fullscreen -->
      <button
        class="control-btn"
        (click)="toggleFullscreen()"
        aria-label="Toggle fullscreen"
        title="Toggle fullscreen"
      >
        <span class="icon">â›¶</span>
      </button>
    </div>
  </div>

  <!-- Stream Info -->
  <div class="stream-info">
    <div class="info-row">
      <span class="info-label">Now Playing:</span>
      <span class="info-value">{{ currentStream().name }}</span>
      <span class="stream-badge" [class]="currentStream().type">{{ currentStream().type | uppercase }}</span>
      @if (currentStream().drm) {
        <span class="stream-badge drm">ğŸ”’ DRM</span>
      }
    </div>
  </div>
</div>
